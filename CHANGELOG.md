# LumiSmart 25 PUBLIC rev. (with menu and memory)
## New firmware for water underfloor heating systems
### by nickolaus


#### 22.06.2022
* добавлена идентификация новой версии устройства:
-- при включении приветственная индикация состоит из голубого и синего цветов
* убран режим "Открытое окно" за ненадобностью
* добавлен режим работы по датчику воздуха с ограничением по температуре пола:
-- при ошибке/отсутствии  датчика пола режим работы == по датчику воздуха
-- режим по умолчанию == по датчику воздуха с ограничением по температуре пола
-- ограничение умолчанию == 28С
* добавлено меню настройки ограничения:
-- вход в меню осуществляется в режиме ожидания (ВЫКЛ) при повороте колеса потенциометра до одного из крайних положений (5 или 45) и ожиданием на этом значении более 3 сек
-- если вход в меню не совершился в одном из крайних положений, то необходимо повторить попытку входа в меню в противоположном положении (своего рода защита)
!- если при входе в меню будет обнаружена ошибка или отсутствие датчика, то прибор несколько раз моргнет красным цветом и не войдет в меню
-- вход в меню подтверждается зеленым индикатором в течение 3 секунд
-- после подтвержения входа происходит активация режима настройки ограничения по температуре пола, активация сопровождается оранжевой подстветкой. Возможность установки значения сохраняется в течение 14 секунд. Установка производится вращением колеса потенциометра (аналогично установке температуры поддержания)
-- по истечении 14 секунд происходит автоматический выход из меню, сопровождается морганием зеленого светодиода. После выхода устройство возвращается режим ожидания (ВЫКЛ)
-- выйти из меню можно нажатием кнопки питания, при этом установленные значения сохранятся, а прибор включится
-- добавлено ограничение в меню при котором без поворота колеса значения не сохранятся
* добавлен новый режим обработки ошибок датчика температуры пола
-- при КЗ датчика включается красная моргающая индикация
-- при перезагрузке (кнопка ВЫКЛ/ВКЛ) устройство переходит в режим по датчику воздуха
-- при отсутствии датчика воздуха устройство переходит в режим по датчику воздуха без индикации ошибки
-- добавлена обработка ошибок "на лету"
-- удалена индикация ошибки, если ошибка была сброшена или режим был переключен из-за ошибки
* добавлена запись ограничения в ОЗУ
* добавлена запись ограничения в ПЗУ (энергонезависимая память)
-- при возникновении ошибки датчика температуры ограничение сбрасывается до значения по умолчанию (28С)
* выполнена корректировка прерываний для более стабильной работы отложенных вызовов
* добавлена задержка включения реле (250мс) для снижения риска "пограничных температур" в новом режиме (увеличение ресурса реле)
* выполнено унифицирующее форматирование части исходников (function.h, function.c, main.c)
* выполнена оптимизация кода
* снижено потребление памяти
* добавлена функция обнаружения перегрева
-- при температуре > 50С терморегулятор прекращает обогрев и включает индикацию (зеленый>желтый>красный)
-- данная индикация обозначает именно перегрев (по любому из датчиков) и нигде не повторяется
-- флаг данной индикации прописан и инициализирован отдельно для лучшей безопасности
